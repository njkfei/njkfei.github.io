title: 微服务系列4-服务发现
date: 2016.03.12
categories: 服务 #分类
tags: [架构 ]
---

* 微服务简介
* 构建微服务：使用API网关
* 构造微服务：微服务架构中的进程间通信
* 微服务架构的服务发现
* 面向微服务的事件驱动数据管理
* 微服务部署选型

## 为什么要使用服务发现
 想象一下，如果我们通过REST API或者Thrift API.为了构造一个请求，我们需要知道服务实例的网络地址(IP：port)．在传统应用运行在物理设备中，网络地址一般是相对不变的．你的客户端可以通过读取配置文件来确定服务的位置．
 但是，现在基于云上构建的微服务应用，服务的地址是经常变化的，因此，通过配置来确定服务位置会遇到困难，如下图所示．
 ![pics]()
 服务实例的地址是动态分配的．另外，服务实例的集合会因为动态的自动伸缩，故障，升级而变化．因此，客户端代码需要使用一种更优雅的服务发现机制．
 这里有两种服务发现机制：
 * 客户端侧服务发现模式
* 服务端侧服务发现模式

## 客户端侧服务发现模式
当使用客户端侧服务发现机制，客户端负责确定可用服务实例的位置，并且在客户端内部完成可用服务实例的负载均衡．客户端通过查询__服务注册中心__(存储可用服务实例的数据库)，获取可以服务实例，然后　客户端使用负载均衡算法，从中选择一个服务实例，再向服务实例发送请求．
如下图所示：
![pics]()

服务实例启动时，将向注册中心注册．当服务实例终止运行时，将在注册中心注销．服务实例通过心跳机制来周期性刷新注册信息．
客户端服务发现模式有很多优点和缺点．
### 优点
* 简单
*  可通过一致性hash来实现负载均衡

### 缺点
* 客户端与注册中心没有解藕．
* 如果存在多语言客户端，每种语言都要实现服务发现逻辑．

## 服务端侧服务发现模式
服务端服务注册中心如下图所示．
![pics]()
客户端通过负载均衡设备发送请求给服务．负载均衡设备查询注册中心，然后将请求路由给基本可用的一个服务实例．
### 方案
* AWS ELB
* NGINX PLUX
* Consul
* DNS
### 优点
* 当然是客户端和注册中心解藕了．

### 缺点
* 需要负载均衡设备,这个需要高可用哦．

## 服务注册
服务注册是服务发现的核心部分．它是一个数据库，用于存储服务实例的网络位置．服务注册中心必须是高可用的．客户端可以从服务注册中心获取服务位置并进行缓存．
## 服务注册选项
### 自注册模式

### 第三方注册模式

## 总结
