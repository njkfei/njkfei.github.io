title: 基于mqtt搭建im和推送系统
date: 2016.05.06
categories: linux #分类
tags: [mqtt,im,push]
toc: true
---

## 问题提出
  我想搞类似于UBER或滴滴的APP应用,流程场景如下：
* 乘客下单
* 系统就近找到候选司机，向司机进行推送
* 司机进行抢单（现在是派单了）
* 司机和乘客进行沟通

## 问题抽象
   基于上述的场景，抽象两个核心服务
* 推送服务
* IM服务
  推送服务用于在用户下单后，后台将订单信息群发到司机端。
  IM服务用于在司机端抢单成功后，乘客与司机之间就如何接机就行沟通

## 解决方案
### 方案一
  对于装机量小的app，可以考虑使用免费的BAIDU云推送等第三方推送系统。但是，第三方系统有明显的缺陷：
* 限速
* 由于限速，会导致时延加大
* 即使不限速，时延也很大
* 到达率不高
* 实时性不高
### 方案二
  方案二采用定制加开发方案。
  采用MQTT开源方案，结合业务需求进行订制。

  方案二优点：
* 采用长连接代替轮询，减少网络流量，和XMPP相比，轻量非常多
* 数据传输可使用二进制数据，结合PB，易于扩展，不要太爽

## DEMO
   会上传至GITHUB上去的。^_^.